import logging

from malduck.extractor import Extractor
from malduck.procmem import ProcessMemory

logger = logging.getLogger(__name__)


class Citadel(Extractor):
    family = "citadel"
    yara_rules = ("citadel",)
    overrides = ["zeus"]

    @Extractor.extractor("briankrebs")
    def citadel_found(self, p: ProcessMemory, addr: int) -> dict:
        logger.info("[+] `Coded by Brian Krebs` str @ %X" % addr)
        return {"family": self.family}

    @Extractor.extractor
    def cit_salt(self, p: ProcessMemory, addr: int) -> dict:
        salt = p.uint32v(addr - 8)
        logger.info("[+] Found salt @ %X - %x" % (addr, salt))
        return {self.family: {"salt": salt}}
